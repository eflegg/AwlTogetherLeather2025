var gulp=require("gulp"),plumber=require("gulp-plumber"),sass=require("gulp-sass"),babel=require("gulp-babel"),postcss=require("gulp-postcss"),watch=require("gulp-watch"),touch=require("gulp-touch-fd"),rename=require("gulp-rename"),concat=require("gulp-concat"),uglify=require("gulp-uglify"),imagemin=require("gulp-imagemin"),ignore=require("gulp-ignore"),rimraf=require("gulp-rimraf"),sourcemaps=require("gulp-sourcemaps"),browserSync=require("browser-sync").create(),del=require("del"),cleanCSS=require("gulp-clean-css"),replace=require("gulp-replace"),autoprefixer=require("autoprefixer"),cfg=require("./gulpconfig.json"),paths=cfg.paths;gulp.task("sass",(function(){return gulp.src(paths.sass+"/*.scss").pipe(plumber({errorHandler:function(s){console.log(s),this.emit("end")}})).pipe(sourcemaps.init({loadMaps:!0})).pipe(sass({errLogToConsole:!0})).pipe(postcss([autoprefixer()])).pipe(sourcemaps.write(void 0,{sourceRoot:null})).pipe(gulp.dest(paths.css)).pipe(touch())})),gulp.task("watch",(function(){gulp.watch([`${paths.sass}/**/*.scss`,`${paths.sass}/*.scss`],gulp.series("styles")),gulp.watch([`${paths.dev}/js/**/*.js`,"js/**/*.js","!js/theme.js","!js/theme.min.js"],gulp.series("scripts")),gulp.watch(`${paths.imgsrc}/**`,gulp.series("imagemin-watch"))})),gulp.task("imagemin",(function(){gulp.src(`${paths.imgsrc}/**`).pipe(imagemin()).pipe(gulp.dest(paths.img))})),gulp.task("imagemin-watch",gulp.series("imagemin",(function(){browserSync.reload()}))),gulp.task("cssnano",(function(){return gulp.src(paths.css+"/theme.css").pipe(sourcemaps.init({loadMaps:!0})).pipe(plumber({errorHandler:function(s){console.log(s),this.emit("end")}})).pipe(rename({suffix:".min"})).pipe(cssnano({discardComments:{removeAll:!0}})).pipe(sourcemaps.write("./")).pipe(gulp.dest(paths.css)).pipe(touch())})),gulp.task("minifycss",(function(){return gulp.src([`${paths.css}/custom-editor-style.css`,`${paths.css}/theme.css`]).pipe(sourcemaps.init({loadMaps:!0})).pipe(cleanCSS({compatibility:"*"})).pipe(plumber({errorHandler:function(s){console.log(s),this.emit("end")}})).pipe(rename({suffix:".min"})).pipe(sourcemaps.write("./")).pipe(gulp.dest(paths.css)).pipe(touch())})),gulp.task("cleancss",(function(){return gulp.src(`${paths.css}/*.min.css`,{read:!1}).pipe(ignore("theme.css")).pipe(rimraf())})),gulp.task("styles",(function(s){gulp.series("sass","minifycss")(s)})),gulp.task("browser-sync",(function(){browserSync.init(cfg.browserSyncWatchFiles,cfg.browserSyncOptions)})),gulp.task("scripts",(function(){var s=[`${paths.dev}/js/bootstrap4/bootstrap.bundle.js`,`${paths.dev}/js/themejs/*.js`,`${paths.dev}/js/skip-link-focus-fix.js`,`${paths.dev}/js/custom-javascript.js`];return gulp.src(s,{allowEmpty:!0}).pipe(babel({presets:["@babel/preset-env"]})).pipe(concat("theme.min.js")).pipe(uglify()).pipe(gulp.dest(paths.js)),gulp.src(s,{allowEmpty:!0}).pipe(babel()).pipe(concat("theme.js")).pipe(gulp.dest(paths.js))})),gulp.task("clean-source",(function(){return del(["src/**/*"])})),gulp.task("watch-bs",gulp.parallel("browser-sync","watch")),gulp.task("copy-assets",(function(s){gulp.src(`${paths.node}bootstrap/dist/js/**/*.js`).pipe(gulp.dest(`${paths.dev}/js/bootstrap4`));gulp.src(`${paths.node}bootstrap/scss/**/*.scss`).pipe(gulp.dest(`${paths.dev}/sass/bootstrap4`)),gulp.src(`${paths.node}font-awesome/fonts/**/*.{ttf,woff,woff2,eot,svg}`).pipe(gulp.dest("./fonts")),gulp.src(`${paths.node}font-awesome/scss/*.scss`).pipe(gulp.dest(`${paths.dev}/sass/fontawesome`)),gulp.src(`${paths.node}undescores-for-npm/sass/media/*.scss`).pipe(gulp.dest(`${paths.dev}/sass/underscores`)),gulp.src(`${paths.node}undescores-for-npm/js/skip-link-focus-fix.js`).pipe(gulp.dest(`${paths.dev}/js`)),s()})),gulp.task("clean-vendor-assets",(function(){return del([`${paths.dev}/js/bootstrap4/**`,`${paths.dev}/sass/bootstrap4/**`,"./fonts/*wesome*.{ttf,woff,woff2,eot,svg}",`${paths.dev}/sass/fontawesome/**`,`${paths.dev}/sass/underscores/**`,`${paths.dev}/js/skip-link-focus-fix.js`,`${paths.js}/**/skip-link-focus-fix.js`,`${paths.js}/**/popper.min.js`,`${paths.js}/**/popper.js`,""!==paths.vendor?paths.js+paths.vendor+"/**":""])})),gulp.task("clean-dist",(function(){return del([paths.dist+"/**"])})),gulp.task("dist",gulp.series(["clean-dist"],(function(){return gulp.src(["**/*",`!${paths.bower}`,`!${paths.bower}/**`,`!${paths.node}`,`!${paths.node}/**`,`!${paths.dev}`,`!${paths.dev}/**`,`!${paths.dist}`,`!${paths.dist}/**`,`!${paths.distprod}`,`!${paths.distprod}/**`,`!${paths.sass}`,`!${paths.sass}/**`,"!readme.txt","!readme.md","!package.json","!package-lock.json","!gulpfile.js","!gulpconfig.json","!CHANGELOG.md","!.travis.yml","!jshintignore","!codesniffer.ruleset.xml","*"],{buffer:!0}).pipe(replace("/js/jquery.slim.min.js","/js"+paths.vendor+"/jquery.slim.min.js",{skipBinary:!0})).pipe(replace("/js/popper.min.js","/js"+paths.vendor+"/popper.min.js",{skipBinary:!0})).pipe(replace("/js/skip-link-focus-fix.js","/js"+paths.vendor+"/skip-link-focus-fix.js",{skipBinary:!0})).pipe(gulp.dest(paths.dist)).pipe(touch())}))),gulp.task("clean-dist-product",(function(){return del([paths.distprod+"/**"])})),gulp.task("dist-product",gulp.series(["clean-dist-product"],(function(){return gulp.src(["**/*",`!${paths.bower}`,`!${paths.bower}/**`,`!${paths.node}`,`!${paths.node}/**`,`!${paths.dist}`,`!${paths.dist}/**`,`!${paths.distprod}`,`!${paths.distprod}/**`,"*"]).pipe(gulp.dest(paths.distprod)).pipe(touch())}))),gulp.task("compile",gulp.series("styles","scripts","dist")),gulp.task("default",gulp.series("watch"));